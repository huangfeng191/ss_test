<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>

  <script>
    function strToUtf8Bytes (str) {
      const utf8 = [];
      for (let ii = 0; ii < str.length; ii++) {
        let charCode = str.charCodeAt(ii);
        if (charCode < 0x80) utf8.push(charCode);
        else if (charCode < 0x800) {
          utf8.push(0xc0 | (charCode >> 6), 0x80 | (charCode & 0x3f));
        } else if (charCode < 0xd800 || charCode >= 0xe000) {
          utf8.push(0xe0 | (charCode >> 12), 0x80 | ((charCode >> 6) & 0x3f), 0x80 | (charCode & 0x3f));
        } else {
          ii++;
          charCode = 0x10000 + (((charCode & 0x3ff) << 10) | (str.charCodeAt(ii) & 0x3ff));
          utf8.push(
            0xf0 | (charCode >> 18),
            0x80 | ((charCode >> 12) & 0x3f),
            0x80 | ((charCode >> 6) & 0x3f),
            0x80 | (charCode & 0x3f),
          );
        }
      }
      for (let jj = 0; jj < utf8.length; jj++) {
        var code = utf8[jj];
        if (code > 127) {
          utf8[jj] = code - 256;
        }
      }
      return utf8;
    }



    /**
     * utf8 byte to unicode string
     * @param utf8Bytes
     * @returns {string}
     */
    function utf8ByteToUnicodeStr (utf8Bytes) {
      var unicodeStr = "";
      for (var pos = 0; pos < utf8Bytes.length;) {
        var flag = utf8Bytes[pos];
        var unicode = 0;
        if ((flag >>> 7) === 0) {
          unicodeStr += String.fromCharCode(utf8Bytes[pos]);
          pos += 1;

        } else if ((flag & 0xFC) === 0xFC) {
          unicode = (utf8Bytes[pos] & 0x3) << 30;
          unicode |= (utf8Bytes[pos + 1] & 0x3F) << 24;
          unicode |= (utf8Bytes[pos + 2] & 0x3F) << 18;
          unicode |= (utf8Bytes[pos + 3] & 0x3F) << 12;
          unicode |= (utf8Bytes[pos + 4] & 0x3F) << 6;
          unicode |= (utf8Bytes[pos + 5] & 0x3F);
          unicodeStr += String.fromCodePoint(unicode);
          pos += 6;

        } else if ((flag & 0xF8) === 0xF8) {
          unicode = (utf8Bytes[pos] & 0x7) << 24;
          unicode |= (utf8Bytes[pos + 1] & 0x3F) << 18;
          unicode |= (utf8Bytes[pos + 2] & 0x3F) << 12;
          unicode |= (utf8Bytes[pos + 3] & 0x3F) << 6;
          unicode |= (utf8Bytes[pos + 4] & 0x3F);
          unicodeStr += String.fromCodePoint(unicode);
          pos += 5;

        } else if ((flag & 0xF0) === 0xF0) {
          unicode = (utf8Bytes[pos] & 0xF) << 18;
          unicode |= (utf8Bytes[pos + 1] & 0x3F) << 12;
          unicode |= (utf8Bytes[pos + 2] & 0x3F) << 6;
          unicode |= (utf8Bytes[pos + 3] & 0x3F);
          unicodeStr += String.fromCodePoint(unicode);
          pos += 4;

        } else if ((flag & 0xE0) === 0xE0) {
          unicode = (utf8Bytes[pos] & 0x1F) << 12;;
          unicode |= (utf8Bytes[pos + 1] & 0x3F) << 6;
          unicode |= (utf8Bytes[pos + 2] & 0x3F);
          unicodeStr += String.fromCharCode(unicode);
          pos += 3;

        } else if ((flag & 0xC0) === 0xC0) { //110
          unicode = (utf8Bytes[pos] & 0x3F) << 6;
          unicode |= (utf8Bytes[pos + 1] & 0x3F);
          unicodeStr += String.fromCharCode(unicode);
          pos += 2;

        } else {
          unicodeStr += String.fromCharCode(utf8Bytes[pos]);
          pos += 1;
        }
      }
      return unicodeStr;
    }



    function str2HexStr (str) {
      var chars = "0123456789ABCDEF".split("");
      var bs = strToUtf8Bytes(str)
      var bit;
      sb = ""
      for (i = 0; i < bs.length; i++) {
        bit = (bs[i] & 0x0f0) >> 4;
        sb += chars[bit];
        bit = bs[i] & 0x0f;
        sb += chars[bit];
      }
      return sb
    }


    function hexStr2Str (hexStr) {
      var str = "0123456789ABCDEF";
      var hexs = hexStr.split("")
      var len = hexStr.length / 2
      var n;
      var bytes = []
      for (var i = 0; i < len; i++) {
        n = str.indexOf(hexs[2 * i]) * 16;
        n += str.indexOf(hexs[2 * i + 1]);
        bytes[i] = (n & 0xff);
      }
      return utf8ByteToUnicodeStr(bytes)

    }
  </script>

</body>

</html>
